# -*- coding: utf-8 -*-
"""dashboard.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1uM6kh2FMKkIedED1hPqyQJ_fvDe9CWIu
"""

import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
import streamlit as st

# Load dataset
day_df = pd.read_csv('https://raw.githubusercontent.com/Sipa02/analisis-data-bike-sharing-dataset/main/data/day.csv')
hour_df = pd.read_csv('https://raw.githubusercontent.com/Sipa02/analisis-data-bike-sharing-dataset/main/data/hour.csv')

# Streamlit Title
st.title('Bike Sharing Dashboard :sparkles:')
st.markdown("<br>", unsafe_allow_html=True)
st.subheader("Jumlah Peminjaman Sepeda Berdasarkan Kategori")
st.markdown("<br>", unsafe_allow_html=True)

# Pilihan kategori
kategori = st.selectbox("Pilih kategori untuk melihat jumlah peminjaman sepeda: ", ["Hari", "Jam", "Musim", "Cuaca"])

# Membuat visualisasi sesuai kategori yang dipilih
fig, ax = plt.subplots()

if kategori == "Musim":
    season_rentals = day_df.groupby('season')['cnt'].sum()
    ax.bar(season_rentals.index, season_rentals.values, color='skyblue')
    ax.set_xlabel("Musim")
    ax.set_ylabel("Jumlah Peminjaman")
    ax.set_title("Jumlah Peminjaman Sepeda Berdasarkan Musim")
    ax.set_xticks([1, 2, 3, 4])
    ax.set_xticklabels(['Spring', 'Summer', 'Fall', 'Winter'])

elif kategori == "Cuaca":
    weather_labels = {
        1: "Clear, Few clouds, Partly cloudy",
        2: "Mist + Cloudy, Broken clouds, Few clouds",
        3: "Light Snow, Light Rain + Thunderstorm",
        4: "Heavy Rain + Thunderstorm, Snow + Fog"
    }
    
    weather_rentals = day_df.groupby('weathersit')['cnt'].sum()
    weather_rentals.index = weather_rentals.index.astype(int)

    valid_indices = [i for i in weather_rentals.index if i in weather_labels]

    bars = ax.bar(valid_indices, weather_rentals.loc[valid_indices].values, color='skyblue')

    ax.set_xlabel("Cuaca")
    ax.set_ylabel("Jumlah Peminjaman")
    ax.set_title("Jumlah Peminjaman Sepeda Berdasarkan Cuaca")
    ax.set_xticks([1, 2, 3, 4])

    legend_labels = [weather_labels[i] for i in valid_indices]
    ax.legend(bars, legend_labels, title="Kategori Cuaca", loc="upper right")

elif kategori == "Hari":
    day_rentals = day_df.groupby('weekday')['cnt'].sum()
    ax.bar(day_rentals.index, day_rentals.values, color='skyblue')
    ax.set_xlabel("Hari")
    ax.set_ylabel("Jumlah Peminjaman")
    ax.set_title("Jumlah Peminjama Sepeda Berdasarkan Hari")
    ax.set_xticks(range(7))
    ax.set_xticklabels(['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'])

elif kategori == "Jam":
    hour_rentals = hour_df.groupby('hr')['cnt'].sum()
    ax.bar(hour_rentals.index, hour_rentals.values, color='skyblue')
    ax.set_xlabel("Jam")
    ax.set_ylabel("Jumlah Peminjaman")
    ax.set_title("Jumlah Peminjaman Sepeda Berdasarkan Jam")
    ax.set_xticks(range(0, 24, 2))

# Menampilkan plot utama di Streamlit
st.pyplot(fig)
st.markdown("<br>", unsafe_allow_html=True)
st.markdown("<br>", unsafe_allow_html=True)
st.markdown("<br>", unsafe_allow_html=True)
st.markdown("<br>", unsafe_allow_html=True)

# ======================== HEATMAP DI BAWAH ========================
st.subheader("Pola Peminjaman Sepeda Berdasarkan Hari dan Jam")

# Peta hari
hari_map = {
    0: 'Min',  # Minggu
    1: 'Sen',  # Senin
    2: 'Sel',  # Selasa
    3: 'Rab',  # Rabu
    4: 'Kam',  # Kamis
    5: 'Jum',  # Jumat
    6: 'Sab'   # Sabtu
}

# Grouping data berdasarkan hari dan jam
hourly_rental_pattern = hour_df.groupby(['weekday', 'hr'])['cnt'].sum().reset_index()

# Ubah nama kolom
hourly_rental_pattern = hourly_rental_pattern.rename(columns={'weekday': 'Hari', 'hr': 'Jam'})

# Ubah hari menjadi singkatan
hourly_rental_pattern['Hari'] = hourly_rental_pattern['Hari'].map(hari_map)

# Atur urutan kategori
ordered_days = ['Min', 'Sen', 'Sel', 'Rab', 'Kam', 'Jum', 'Sab']
hourly_rental_pattern['Hari'] = pd.Categorical(hourly_rental_pattern['Hari'], categories=ordered_days, ordered=True)

# Urutkan data berdasarkan hari (opsional, tapi membantu memastikan urutan yang benar)
hourly_rental_pattern = hourly_rental_pattern.sort_values('Hari')

# Buat pivot table
pivot_table = hourly_rental_pattern.pivot(index='Hari', columns='Jam', values='cnt')

# Buat heatmap
fig, ax = plt.subplots(figsize=(12, 6))
sns.heatmap(pivot_table, cmap='viridis', annot=False, fmt=".0f", ax=ax)

ax.set_xlabel('Jam')
ax.set_ylabel('Hari')

# Tampilkan heatmap di Streamlit
st.pyplot(fig)
